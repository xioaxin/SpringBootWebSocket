<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>群聊</title>
<!--    <script src="/webjars/jquery/jquery.js"></script>-->
    <script src="js/sockjs.min.js"></script>
    <script src="js/stomp.min.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <!--    <script src="./app.js"></script>-->
    <script>
        $(function () {
            $('#connect').click(function () {
                connect();
            });
            $('#disConnect').click(function () {
                disConnect();
            });
            $('#send').click(function () {
                sendName();
            })
        })

    </script>
</head>
<body>
<div>
    <label for="name">请输入用户名</label>
    <input type="text" id="name" placeholder="用户名">
</div>
<div>
    <button id="connect" type="button">连接</button>
    <button id="disConnect" type="button" disabled="disabled">断开连接</button>
</div>
<div id="chat" style="display: none">
</div>
<div>
    <label for="name">请输入聊天内容:</label>
    <input type="text" id="content" placeholder="聊天内容">
</div>
<div>
    <button type="button" id="send">发送</button>
</div>
<div id="greeting">
    <div id="conversation" style="display: none">群聊中</div>
</div>
<script>
    var stompClient = null;

    //创建连接
    function setConnected(connected) {
        $('#connect').prop("display", connected);
        $('#disConnect').prop("displayed", !connected);
        if (connected) {
            $('#conversation').show();
            $('#chat').show();
        } else {
            $('#conversation').hide();
            $('#chat').hide();
        }
        $('#greeting').html("");
    }

    function connect() {
        if ($('#name').val() == null) {
            return;
        }
        var socket = new SockJS("/chat");
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            setConnected(true);
            stompClient.subscribe("/topic/greetings", function (greeting) {
                showGreeting(JSON.parse(greeting.body));
            });
        });
    }

    function disConnect() {
        if (stompClient != null) {
            stompClient.disconnect();
        }
        setConnected(false);
    }

    function sendName() {
        stompClient.send('/app/hello', {}, JSON.stringify(
            {
                'name': $('#name').val(),
                'content': $('#content').val()
            }));
    }

    function showGreeting(message) {
        $('#greeting').append('<div>' + message.name + ':' + message.content + '</div>'
        )
    }
</script>
</body>
</html>